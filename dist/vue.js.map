{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/lifecycle.js","../src/utils.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-22 21:30:18\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:04:04\r\n */\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nfunction genProps(attrs) {\r\n  let str = \"\";\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i];\r\n    if (attr.name === \"style\") {\r\n      let styleObj = {};\r\n      attr.value.replace(/([^;:]+)\\:([^;:]+)/g, function () {\r\n        styleObj[arguments[1]] = arguments[2];\r\n      });\r\n      attr.value = styleObj;\r\n    }\r\n    str += `${attr.name}: ${JSON.stringify(attr.value)},`;\r\n  }\r\n  return `{${str.slice(0, -1)}}`;\r\n}\r\n\r\nfunction genChildren(el) {\r\n  let children = el.children;\r\n\r\n  if (children) {\r\n    return children.map((child) => gen(child)).join(\",\");\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction gen(el) {\r\n  if (el.type == 1) {\r\n    return generate(el);\r\n  } else {\r\n    let text = el.text.trim();\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v('${text}')`;\r\n    } else {\r\n      let tokens = [];\r\n      let match;\r\n      // exec和正则中的g冲突, 每次操作的时候都要重置成0\r\n      let lastIndex = (defaultTagRE.lastIndex = 0);\r\n      while ((match = defaultTagRE.exec(text))) {\r\n        let index = match.index;\r\n        if (index > lastIndex) {\r\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)));\r\n        }\r\n        tokens.push(`_s(${match[1].trim()})`);\r\n        lastIndex = index + match[0].length;\r\n      }\r\n      if (lastIndex < text.length) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex)));\r\n      }\r\n      return `_v(${tokens.join(\"+\")})`;\r\n    }\r\n  }\r\n}\r\n\r\nexport function generate(el) {\r\n  let children = genChildren(el);\r\n\r\n  let code = `_c('${el.tag}',${\r\n    el.attrs && el.attrs.length > 0 ? genProps(el.attrs) : \"undefined\"\r\n  }${children ? `,${children}` : \"\"})`;\r\n\r\n  return code;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-22 21:17:10\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-22 21:18:21\r\n */\r\n\r\n// 标签名\r\nconst ncname = `[a-zA-Z_][\\\\w\\\\-\\\\.]*`;\r\n// 获取标签名, match[1]\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\n// 开始标签\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\n// 结束标签\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\n// 属性\r\nconst attribute =\r\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n// 标签关闭\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\n// {{}}\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nexport function parserHTML(html) {\r\n  let stack = [];\r\n  let root = null;\r\n  function createASTElement(tag, attrs, parent) {\r\n    return {\r\n      tag,\r\n      type: 1,\r\n      children: [],\r\n      parent,\r\n      attrs,\r\n    };\r\n  }\r\n  function start(tag, attrs) {\r\n    // console.log(\"start\", tag, attrs);\r\n    let parent = stack[stack.length - 1];\r\n    let element = createASTElement(tag, attrs, parent);\r\n    if (root == null) {\r\n      root = element;\r\n    }\r\n    if (parent) {\r\n      // 元素指向父节点\r\n      element.parent = parent;\r\n      // 父节点的children属性添加元素\r\n      parent.children.push(element);\r\n    }\r\n    stack.push(element);\r\n  }\r\n\r\n  function end(tag) {\r\n    // console.log(\"end\", tag);\r\n    let endTag = stack.pop();\r\n    if (endTag.tag != tag) {\r\n      console.log(\"标签出错\");\r\n    }\r\n  }\r\n\r\n  function text(chars) {\r\n    // console.log(\"text\", chars);\r\n    let parent = stack[stack.length - 1];\r\n    chars.replace(/\\s/, \"\");\r\n    if (chars) {\r\n      parent.children.push({\r\n        type: 2,\r\n        text: chars,\r\n      });\r\n    }\r\n  }\r\n\r\n  function advance(len) {\r\n    html = html.substring(len);\r\n  }\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen);\r\n    if (start) {\r\n      const match = {\r\n        tagName: start[1],\r\n        attrs: [],\r\n      };\r\n      advance(start[0].length);\r\n      // console.log(match, html);\r\n      let end;\r\n      let attr;\r\n      // 不能是开始的结束标签\r\n      // 必须是属性\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5],\r\n        });\r\n        advance(attr[0].length);\r\n      }\r\n      // console.log(\"end\", end);\r\n      if (end) {\r\n        advance(end[0].length);\r\n      }\r\n\r\n      return match;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  while (html) {\r\n    let index = html.indexOf(\"<\");\r\n\r\n    if (index === 0) {\r\n      // 解析开始标签\r\n      const startTagMatch = parseStartTag();\r\n\r\n      if (startTagMatch) {\r\n        start(startTagMatch.tagName, startTagMatch.attrs);\r\n        continue;\r\n      }\r\n      let endTagMatch;\r\n      if ((endTagMatch = html.match(endTag))) {\r\n        end(endTagMatch[1]);\r\n        advance(endTagMatch[0].length);\r\n        continue;\r\n      }\r\n\r\n      break;\r\n    }\r\n    // 文本\r\n    if (index > 0) {\r\n      let chars = html.substring(0, index);\r\n      if (chars) {\r\n        text(chars);\r\n        advance(chars.length);\r\n      }\r\n    }\r\n  }\r\n  console.log(\"root\", root);\r\n  return root;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-21 20:40:53\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:16:27\r\n */\r\n\r\nimport { generate } from \"./generate\";\r\nimport { parserHTML } from \"./parser\";\r\n\r\nexport function compileToFunction(tempalte) {\r\n  const ast = parserHTML(tempalte);\r\n\r\n  let code = generate(ast);\r\n  console.log(\"code\", code);\r\n  // html => ast(只能描述语法) => render函数 => vdom(增加额外属性) => 生成真实DOM\r\n  // new Function + width\r\n  let render = new Function(`with(this) {return ${code}}`);\r\n  return render;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:18:30\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:24:15\r\n */\r\n\r\nexport function lifecycleMixin(Vue) {\r\n  Vue.prototype._update = function (vnode) {\r\n    console.log(\"_update\");\r\n  };\r\n}\r\n\r\nexport function mountComponent(vm, el) {\r\n  // 更新函数, 数据变化后会再次调用\r\n  let updateComponent = () => {\r\n    // 调用render函数, 生成虚拟dom\r\n    vm._update(vm._render());\r\n    // 用虚拟dom生成真实dom\r\n  };\r\n  updateComponent();\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:35:20\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-21 20:45:23\r\n */\r\nexport const isFunction = (fn) => typeof fn === \"function\";\r\nexport const isObject = (obj) => typeof obj === \"object\" && obj !== null;\r\nexport const isArray = (arr) => Array.isArray(arr);\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-21 20:23:55\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-21 20:50:04\r\n */\r\nconst oldArrayPrototype = Array.prototype;\r\nconst arrayMethods = Object.create(oldArrayPrototype);\r\n\r\nconst methods = [\r\n  \"push\",\r\n  \"pop\",\r\n  \"shift\",\r\n  \"unshift\",\r\n  \"splice\",\r\n  \"reverse\",\r\n  \"sort\",\r\n];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    oldArrayPrototype[method].call(this, ...args);\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshfit\":\r\n        inserted = args; // 就是新增的内容\r\n        break;\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    if (inserted) {\r\n      ob.observeArray(inserted);\r\n    }\r\n  };\r\n});\r\n\r\nexport default arrayMethods;\r\n","import { isArray, isObject } from \"../utils\";\r\nimport arrayMethods from \"./array\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:38:12\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-21 21:21:41\r\n */\r\nclass Observer {\r\n  constructor(data) {\r\n    // 给对象和数组添加一个自定义属性\r\n    // __ob__ 会造成死循环\r\n    Object.defineProperty(data, \"__ob__\", {\r\n      value: this,\r\n      // 这属性不能被枚举, 无法被循环到\r\n      enumerable: false,\r\n    });\r\n    // data.__ob__ = this;\r\n    if (isArray(data)) {\r\n      // 重写数组方法\r\n      data.__proto__ = arrayMethods;\r\n      this.observeArray(data);\r\n    } else {\r\n      this.walk(data);\r\n    }\r\n  }\r\n  // 递归遍历数组, 对数组内部的对象再次进行重写[[]] [{}]\r\n  observeArray(data) {\r\n    // 数组里面如果是引用类型, 继续进行observe, 响应式\r\n    data.forEach((item) => observe(item));\r\n  }\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  // value有可能是对象\r\n  // 如果value是对象, 需要进行递归处理\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newVal) {\r\n      if (newVal === value) return;\r\n      // 设置了新对象, 需要重新进行劫持\r\n      observe(newVal);\r\n      value = newVal;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  console.log(\"observe\", data);\r\n  if (!isObject(data)) {\r\n    return;\r\n  }\r\n  if (data.__ob__) {\r\n    return;\r\n  }\r\n  return new Observer(data);\r\n}\r\n","import { observe } from \"./observer\";\r\nimport { isFunction } from \"./utils\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:29:52\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-21 20:10:58\r\n */\r\nexport function initState(vm) {\r\n  console.log(\"initState\", vm.$options);\r\n  const opts = vm.$options;\r\n  // if (opts.props) {\r\n  // }\r\n\r\n  // if (opts.methods) {\r\n  // }\r\n\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n\r\n  // if (opts.computed) {\r\n  // }\r\n\r\n  // if (opts.watch) {\r\n  // }\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal;\r\n    },\r\n  });\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n  for (const key in data) {\r\n    proxy(vm, \"_data\", key);\r\n  }\r\n  // console.log(\"initData\", data);\r\n  observe(data);\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:24:30\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:19:06\r\n */\r\n\r\nimport { compileToFunction } from \"./compiler\";\r\nimport { mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\n\r\n/**\r\n *\r\n * 在Vue的基础上做一次混合操作\r\n * @export\r\n * @param {*} Vue\r\n */\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // console.log(\"options\", options);\r\n    const vm = this;\r\n    vm.$options = options;\r\n    initState(vm);\r\n\r\n    if (vm.$options.el) {\r\n      // 将数据挂在模板上\r\n      vm.$mount(vm.$options.el);\r\n    }\r\n  };\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this;\r\n    const options = vm.$options;\r\n    el = document.querySelector(el);\r\n\r\n    if (!options.render) {\r\n      let template = options.template;\r\n      if (!template && el) {\r\n        console.log(\"el\", el);\r\n        template = el.outerHTML;\r\n        let render = compileToFunction(template);\r\n        options.render = render;\r\n      }\r\n    }\r\n    console.log(options.render);\r\n    // 组件的挂载流程\r\n    mountComponent(vm, el);\r\n  };\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:31:22\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:35:54\r\n */\r\nexport function createElement(vm, tag, data = {}, ...children) {\r\n  return vnode(vm, tag, data, data.key, children, undefined);\r\n}\r\n\r\nexport function createTextElement(vm, text) {\r\n  return vnode(vm, undefined, undefined, undefined, undefined, text);\r\n}\r\n\r\nfunction vnode(vm, tag, data, key, children, text) {\r\n  return { vm, tag, data, key, children, text };\r\n}\r\n","import { createElement, createTextElement } from \"./vdom\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:23:10\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:33:23\r\n */\r\nexport function renderMixin(Vue) {\r\n  Vue.prototype._c = function (tag, data, ...children) {\r\n    // @ts-ignore\r\n    return createElement(this, ...arguments);\r\n  };\r\n  Vue.prototype._v = function (text) {\r\n    return createTextElement(this, text);\r\n  };\r\n  Vue.prototype._s = function (val) {\r\n    return JSON.stringify(val);\r\n  };\r\n  Vue.prototype._render = function () {\r\n    console.log(\"_render\");\r\n    const vm = this;\r\n    let render = vm.$options.render;\r\n    let vnode = render.call(vm);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\nimport { lifecycleMixin } from \"./lifecycle\";\r\nimport { renderMixin } from \"./render\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:07:28\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:23:40\r\n */\r\nfunction Vue(options) {\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\nrenderMixin(Vue); // _render\r\nlifecycleMixin(Vue); // _update\r\n\r\nexport default Vue;\r\n"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","styleObj","value","replace","arguments","JSON","stringify","slice","genChildren","el","children","map","child","gen","join","type","generate","text","trim","test","tokens","match","lastIndex","exec","index","push","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","stack","root","createASTElement","parent","start","element","end","pop","console","log","chars","advance","len","substring","parseStartTag","tagName","indexOf","startTagMatch","endTagMatch","compileToFunction","tempalte","ast","render","Function","lifecycleMixin","Vue","prototype","_update","vnode","mountComponent","vm","updateComponent","_render","isFunction","fn","isObject","obj","isArray","arr","Array","oldArrayPrototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","observeArray","Observer","data","defineProperty","enumerable","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newVal","initState","$options","opts","initData","proxy","source","_data","initMixin","_init","options","$mount","document","querySelector","template","outerHTML","createElement","undefined","createTextElement","renderMixin","_c","_v","_s","val"],"mappings":";;;;;;EAAA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAMA,YAAY,GAAG,0BAArB;;EAEA,SAASC,QAAT,CAAkBC,KAAlB,EAAyB;EACvB,MAAIC,GAAG,GAAG,EAAV;;EACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrC,QAAIE,IAAI,GAAGJ,KAAK,CAACE,CAAD,CAAhB;;EACA,QAAIE,IAAI,CAACC,IAAL,KAAc,OAAlB,EAA2B;EAAA;EACzB,YAAIC,QAAQ,GAAG,EAAf;EACAF,QAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmB,qBAAnB,EAA0C,YAAY;EACpDF,UAAAA,QAAQ,CAACG,SAAS,CAAC,CAAD,CAAV,CAAR,GAAyBA,SAAS,CAAC,CAAD,CAAlC;EACD,SAFD;EAGAL,QAAAA,IAAI,CAACG,KAAL,GAAaD,QAAb;EALyB;EAM1B;;EACDL,IAAAA,GAAG,cAAOG,IAAI,CAACC,IAAZ,eAAqBK,IAAI,CAACC,SAAL,CAAeP,IAAI,CAACG,KAApB,CAArB,MAAH;EACD;;EACD,oBAAWN,GAAG,CAACW,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAX;EACD;;EAED,SAASC,WAAT,CAAqBC,EAArB,EAAyB;EACvB,MAAIC,QAAQ,GAAGD,EAAE,CAACC,QAAlB;;EAEA,MAAIA,QAAJ,EAAc;EACZ,WAAOA,QAAQ,CAACC,GAAT,CAAa,UAACC,KAAD;EAAA,aAAWC,GAAG,CAACD,KAAD,CAAd;EAAA,KAAb,EAAoCE,IAApC,CAAyC,GAAzC,CAAP;EACD;;EACD,SAAO,KAAP;EACD;;EAED,SAASD,GAAT,CAAaJ,EAAb,EAAiB;EACf,MAAIA,EAAE,CAACM,IAAH,IAAW,CAAf,EAAkB;EAChB,WAAOC,QAAQ,CAACP,EAAD,CAAf;EACD,GAFD,MAEO;EACL,QAAIQ,IAAI,GAAGR,EAAE,CAACQ,IAAH,CAAQC,IAAR,EAAX;;EACA,QAAI,CAACzB,YAAY,CAAC0B,IAAb,CAAkBF,IAAlB,CAAL,EAA8B;EAC5B,2BAAcA,IAAd;EACD,KAFD,MAEO;EACL,UAAIG,MAAM,GAAG,EAAb;EACA,UAAIC,KAAJ,CAFK;;EAIL,UAAIC,SAAS,GAAI7B,YAAY,CAAC6B,SAAb,GAAyB,CAA1C;;EACA,aAAQD,KAAK,GAAG5B,YAAY,CAAC8B,IAAb,CAAkBN,IAAlB,CAAhB,EAA0C;EACxC,YAAIO,KAAK,GAAGH,KAAK,CAACG,KAAlB;;EACA,YAAIA,KAAK,GAAGF,SAAZ,EAAuB;EACrBF,UAAAA,MAAM,CAACK,IAAP,CAAYpB,IAAI,CAACC,SAAL,CAAeW,IAAI,CAACV,KAAL,CAAWe,SAAX,EAAsBE,KAAtB,CAAf,CAAZ;EACD;;EACDJ,QAAAA,MAAM,CAACK,IAAP,cAAkBJ,KAAK,CAAC,CAAD,CAAL,CAASH,IAAT,EAAlB;EACAI,QAAAA,SAAS,GAAGE,KAAK,GAAGH,KAAK,CAAC,CAAD,CAAL,CAASvB,MAA7B;EACD;;EACD,UAAIwB,SAAS,GAAGL,IAAI,CAACnB,MAArB,EAA6B;EAC3BsB,QAAAA,MAAM,CAACK,IAAP,CAAYpB,IAAI,CAACC,SAAL,CAAeW,IAAI,CAACV,KAAL,CAAWe,SAAX,CAAf,CAAZ;EACD;;EACD,0BAAaF,MAAM,CAACN,IAAP,CAAY,GAAZ,CAAb;EACD;EACF;EACF;;EAEM,SAASE,QAAT,CAAkBP,EAAlB,EAAsB;EAC3B,MAAIC,QAAQ,GAAGF,WAAW,CAACC,EAAD,CAA1B;EAEA,MAAIiB,IAAI,iBAAUjB,EAAE,CAACkB,GAAb,eACNlB,EAAE,CAACd,KAAH,IAAYc,EAAE,CAACd,KAAH,CAASG,MAAT,GAAkB,CAA9B,GAAkCJ,QAAQ,CAACe,EAAE,CAACd,KAAJ,CAA1C,GAAuD,WADjD,SAELe,QAAQ,cAAOA,QAAP,IAAoB,EAFvB,MAAR;EAIA,SAAOgB,IAAP;EACD;;ECvED;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA,IAAME,MAAM,0BAAZ;;EAEA,IAAMC,YAAY,iBAAUD,MAAV,kBAAwBA,MAAxB,MAAlB;;EAEA,IAAME,YAAY,GAAG,IAAIC,MAAJ,aAAgBF,YAAhB,EAArB;;EAEA,IAAMG,MAAM,GAAG,IAAID,MAAJ,gBAAmBF,YAAnB,YAAf;;EAEA,IAAMI,SAAS,GACb,2EADF;;EAGA,IAAMC,aAAa,GAAG,YAAtB;EAIO,SAASC,UAAT,CAAoBC,IAApB,EAA0B;EAC/B,MAAIC,KAAK,GAAG,EAAZ;EACA,MAAIC,IAAI,GAAG,IAAX;;EACA,WAASC,gBAAT,CAA0BZ,GAA1B,EAA+BhC,KAA/B,EAAsC6C,MAAtC,EAA8C;EAC5C,WAAO;EACLb,MAAAA,GAAG,EAAHA,GADK;EAELZ,MAAAA,IAAI,EAAE,CAFD;EAGLL,MAAAA,QAAQ,EAAE,EAHL;EAIL8B,MAAAA,MAAM,EAANA,MAJK;EAKL7C,MAAAA,KAAK,EAALA;EALK,KAAP;EAOD;;EACD,WAAS8C,KAAT,CAAed,GAAf,EAAoBhC,KAApB,EAA2B;EACzB;EACA,QAAI6C,MAAM,GAAGH,KAAK,CAACA,KAAK,CAACvC,MAAN,GAAe,CAAhB,CAAlB;EACA,QAAI4C,OAAO,GAAGH,gBAAgB,CAACZ,GAAD,EAAMhC,KAAN,EAAa6C,MAAb,CAA9B;;EACA,QAAIF,IAAI,IAAI,IAAZ,EAAkB;EAChBA,MAAAA,IAAI,GAAGI,OAAP;EACD;;EACD,QAAIF,MAAJ,EAAY;EACV;EACAE,MAAAA,OAAO,CAACF,MAAR,GAAiBA,MAAjB,CAFU;;EAIVA,MAAAA,MAAM,CAAC9B,QAAP,CAAgBe,IAAhB,CAAqBiB,OAArB;EACD;;EACDL,IAAAA,KAAK,CAACZ,IAAN,CAAWiB,OAAX;EACD;;EAED,WAASC,GAAT,CAAahB,GAAb,EAAkB;EAChB;EACA,QAAIK,MAAM,GAAGK,KAAK,CAACO,GAAN,EAAb;;EACA,QAAIZ,MAAM,CAACL,GAAP,IAAcA,GAAlB,EAAuB;EACrBkB,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;EACD;EACF;;EAED,WAAS7B,IAAT,CAAc8B,KAAd,EAAqB;EACnB;EACA,QAAIP,MAAM,GAAGH,KAAK,CAACA,KAAK,CAACvC,MAAN,GAAe,CAAhB,CAAlB;EACAiD,IAAAA,KAAK,CAAC5C,OAAN,CAAc,IAAd,EAAoB,EAApB;;EACA,QAAI4C,KAAJ,EAAW;EACTP,MAAAA,MAAM,CAAC9B,QAAP,CAAgBe,IAAhB,CAAqB;EACnBV,QAAAA,IAAI,EAAE,CADa;EAEnBE,QAAAA,IAAI,EAAE8B;EAFa,OAArB;EAID;EACF;;EAED,WAASC,OAAT,CAAiBC,GAAjB,EAAsB;EACpBb,IAAAA,IAAI,GAAGA,IAAI,CAACc,SAAL,CAAeD,GAAf,CAAP;EACD;;EACD,WAASE,aAAT,GAAyB;EACvB,QAAMV,KAAK,GAAGL,IAAI,CAACf,KAAL,CAAWS,YAAX,CAAd;;EACA,QAAIW,KAAJ,EAAW;EACT,UAAMpB,KAAK,GAAG;EACZ+B,QAAAA,OAAO,EAAEX,KAAK,CAAC,CAAD,CADF;EAEZ9C,QAAAA,KAAK,EAAE;EAFK,OAAd;EAIAqD,MAAAA,OAAO,CAACP,KAAK,CAAC,CAAD,CAAL,CAAS3C,MAAV,CAAP,CALS;;EAOT,UAAI6C,IAAJ;;EACA,UAAI5C,IAAJ,CARS;EAUT;;EACA,aACE,EAAE4C,IAAG,GAAGP,IAAI,CAACf,KAAL,CAAWa,aAAX,CAAR,MACCnC,IAAI,GAAGqC,IAAI,CAACf,KAAL,CAAWY,SAAX,CADR,CADF,EAGE;EACAZ,QAAAA,KAAK,CAAC1B,KAAN,CAAY8B,IAAZ,CAAiB;EACfzB,UAAAA,IAAI,EAAED,IAAI,CAAC,CAAD,CADK;EAEfG,UAAAA,KAAK,EAAEH,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFlB,SAAjB;EAIAiD,QAAAA,OAAO,CAACjD,IAAI,CAAC,CAAD,CAAJ,CAAQD,MAAT,CAAP;EACD,OApBQ;;;EAsBT,UAAI6C,IAAJ,EAAS;EACPK,QAAAA,OAAO,CAACL,IAAG,CAAC,CAAD,CAAH,CAAO7C,MAAR,CAAP;EACD;;EAED,aAAOuB,KAAP;EACD,KA3BD,MA2BO;EACL,aAAO,KAAP;EACD;EACF;;EAED,SAAOe,IAAP,EAAa;EACX,QAAIZ,KAAK,GAAGY,IAAI,CAACiB,OAAL,CAAa,GAAb,CAAZ;;EAEA,QAAI7B,KAAK,KAAK,CAAd,EAAiB;EACf;EACA,UAAM8B,aAAa,GAAGH,aAAa,EAAnC;;EAEA,UAAIG,aAAJ,EAAmB;EACjBb,QAAAA,KAAK,CAACa,aAAa,CAACF,OAAf,EAAwBE,aAAa,CAAC3D,KAAtC,CAAL;EACA;EACD;;EACD,UAAI4D,WAAW,SAAf;;EACA,UAAKA,WAAW,GAAGnB,IAAI,CAACf,KAAL,CAAWW,MAAX,CAAnB,EAAwC;EACtCW,QAAAA,GAAG,CAACY,WAAW,CAAC,CAAD,CAAZ,CAAH;EACAP,QAAAA,OAAO,CAACO,WAAW,CAAC,CAAD,CAAX,CAAezD,MAAhB,CAAP;EACA;EACD;;EAED;EACD,KAnBU;;;EAqBX,QAAI0B,KAAK,GAAG,CAAZ,EAAe;EACb,UAAIuB,KAAK,GAAGX,IAAI,CAACc,SAAL,CAAe,CAAf,EAAkB1B,KAAlB,CAAZ;;EACA,UAAIuB,KAAJ,EAAW;EACT9B,QAAAA,IAAI,CAAC8B,KAAD,CAAJ;EACAC,QAAAA,OAAO,CAACD,KAAK,CAACjD,MAAP,CAAP;EACD;EACF;EACF;;EACD+C,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBR,IAApB;EACA,SAAOA,IAAP;EACD;;EC7ID;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAKO,SAASkB,iBAAT,CAA2BC,QAA3B,EAAqC;EAC1C,MAAMC,GAAG,GAAGvB,UAAU,CAACsB,QAAD,CAAtB;EAEA,MAAI/B,IAAI,GAAGV,QAAQ,CAAC0C,GAAD,CAAnB;EACAb,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBpB,IAApB,EAJ0C;EAM1C;;EACA,MAAIiC,MAAM,GAAG,IAAIC,QAAJ,8BAAmClC,IAAnC,OAAb;EACA,SAAOiC,MAAP;EACD;;ECrBD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEO,SAASE,cAAT,CAAwBC,GAAxB,EAA6B;EAClCA,EAAAA,GAAG,CAACC,SAAJ,CAAcC,OAAd,GAAwB,UAAUC,KAAV,EAAiB;EACvCpB,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;EACD,GAFD;EAGD;EAEM,SAASoB,cAAT,CAAwBC,EAAxB,EAA4B1D,EAA5B,EAAgC;EACrC;EACA,MAAI2D,eAAe,GAAG,SAAlBA,eAAkB,GAAM;EAC1B;EACAD,IAAAA,EAAE,CAACH,OAAH,CAAWG,EAAE,CAACE,OAAH,EAAX,EAF0B;;EAI3B,GAJD;;EAKAD,EAAAA,eAAe;EAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ECvBD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,IAAME,UAAU,GAAG,SAAbA,UAAa,CAACC,EAAD;EAAA,SAAQ,OAAOA,EAAP,KAAc,UAAtB;EAAA,CAAnB;EACA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,GAAD;EAAA,SAAS,QAAOA,GAAP,MAAe,QAAf,IAA2BA,GAAG,KAAK,IAA5C;EAAA,CAAjB;EACA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,GAAD;EAAA,SAASC,KAAK,CAACF,OAAN,CAAcC,GAAd,CAAT;EAAA,CAAhB;;ECVP;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAME,iBAAiB,GAAGD,KAAK,CAACb,SAAhC;EACA,IAAMe,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcH,iBAAd,CAArB;EAEA,IAAMI,OAAO,GAAG,CACd,MADc,EAEd,KAFc,EAGd,OAHc,EAId,SAJc,EAKd,QALc,EAMd,SANc,EAOd,MAPc,CAAhB;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAACC,MAAD,EAAY;EAC1BL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,YAAmB;EAAA;;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACxC,6BAAAP,iBAAiB,CAACM,MAAD,CAAjB,EAA0BE,IAA1B,+BAA+B,IAA/B,SAAwCD,IAAxC;;EACA,QAAIE,QAAJ;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQL,MAAR;EACE,WAAK,MAAL;EACA,WAAK,SAAL;EACEG,QAAAA,QAAQ,GAAGF,IAAX,CADF;;EAEE;;EACF,WAAK,QAAL;EACEE,QAAAA,QAAQ,GAAGF,IAAI,CAAC7E,KAAL,CAAW,CAAX,CAAX;EACA;EAPJ;;EAWA,QAAI+E,QAAJ,EAAc;EACZC,MAAAA,EAAE,CAACE,YAAH,CAAgBH,QAAhB;EACD;EACF,GAlBD;EAmBD,CApBD;;EClBA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;MACMI;EACJ,oBAAYC,IAAZ,EAAkB;EAAA;;EAChB;EACA;EACAZ,IAAAA,MAAM,CAACa,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCzF,MAAAA,KAAK,EAAE,IAD6B;EAEpC;EACA2F,MAAAA,UAAU,EAAE;EAHwB,KAAtC,EAHgB;;EAShB,QAAInB,OAAO,CAACiB,IAAD,CAAX,EAAmB;EACjB;EACAA,MAAAA,IAAI,CAACG,SAAL,GAAiBhB,YAAjB;EACA,WAAKW,YAAL,CAAkBE,IAAlB;EACD,KAJD,MAIO;EACL,WAAKI,IAAL,CAAUJ,IAAV;EACD;EACF;;;;;aAED,sBAAaA,IAAb,EAAmB;EACjB;EACAA,MAAAA,IAAI,CAACT,OAAL,CAAa,UAACc,IAAD;EAAA,eAAUC,OAAO,CAACD,IAAD,CAAjB;EAAA,OAAb;EACD;;;aACD,cAAKL,IAAL,EAAW;EACTZ,MAAAA,MAAM,CAACmB,IAAP,CAAYP,IAAZ,EAAkBT,OAAlB,CAA0B,UAACiB,GAAD,EAAS;EACjCC,QAAAA,cAAc,CAACT,IAAD,EAAOQ,GAAP,EAAYR,IAAI,CAACQ,GAAD,CAAhB,CAAd;EACD,OAFD;EAGD;;;;;;EAGH,SAASC,cAAT,CAAwBT,IAAxB,EAA8BQ,GAA9B,EAAmCjG,KAAnC,EAA0C;EACxC;EACA;EACA+F,EAAAA,OAAO,CAAC/F,KAAD,CAAP;EACA6E,EAAAA,MAAM,CAACa,cAAP,CAAsBD,IAAtB,EAA4BQ,GAA5B,EAAiC;EAC/BE,IAAAA,GAD+B,iBACzB;EACJ,aAAOnG,KAAP;EACD,KAH8B;EAI/BoG,IAAAA,GAJ+B,eAI3BC,MAJ2B,EAInB;EACV,UAAIA,MAAM,KAAKrG,KAAf,EAAsB,OADZ;;EAGV+F,MAAAA,OAAO,CAACM,MAAD,CAAP;EACArG,MAAAA,KAAK,GAAGqG,MAAR;EACD;EAT8B,GAAjC;EAWD;;EAEM,SAASN,OAAT,CAAiBN,IAAjB,EAAuB;EAC5B9C,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuB6C,IAAvB;;EACA,MAAI,CAACnB,QAAQ,CAACmB,IAAD,CAAb,EAAqB;EACnB;EACD;;EACD,MAAIA,IAAI,CAACH,MAAT,EAAiB;EACf;EACD;;EACD,SAAO,IAAIE,QAAJ,CAAaC,IAAb,CAAP;EACD;;EChED;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACO,SAASa,SAAT,CAAmBrC,EAAnB,EAAuB;EAC5BtB,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBqB,EAAE,CAACsC,QAA5B;EACA,MAAMC,IAAI,GAAGvC,EAAE,CAACsC,QAAhB,CAF4B;EAI5B;EAEA;EACA;;EAEA,MAAIC,IAAI,CAACf,IAAT,EAAe;EACbgB,IAAAA,QAAQ,CAACxC,EAAD,CAAR;EACD,GAX2B;EAc5B;EAEA;EACA;;EACD;;EAED,SAASyC,KAAT,CAAezC,EAAf,EAAmB0C,MAAnB,EAA2BV,GAA3B,EAAgC;EAC9BpB,EAAAA,MAAM,CAACa,cAAP,CAAsBzB,EAAtB,EAA0BgC,GAA1B,EAA+B;EAC7BE,IAAAA,GAD6B,iBACvB;EACJ,aAAOlC,EAAE,CAAC0C,MAAD,CAAF,CAAWV,GAAX,CAAP;EACD,KAH4B;EAI7BG,IAAAA,GAJ6B,eAIzBC,MAJyB,EAIjB;EACVpC,MAAAA,EAAE,CAAC0C,MAAD,CAAF,CAAWV,GAAX,IAAkBI,MAAlB;EACD;EAN4B,GAA/B;EAQD;;EAED,SAASI,QAAT,CAAkBxC,EAAlB,EAAsB;EACpB,MAAIwB,IAAI,GAAGxB,EAAE,CAACsC,QAAH,CAAYd,IAAvB;EACAA,EAAAA,IAAI,GAAGxB,EAAE,CAAC2C,KAAH,GAAWxC,UAAU,CAACqB,IAAD,CAAV,GAAmBA,IAAI,CAACN,IAAL,CAAUlB,EAAV,CAAnB,GAAmCwB,IAArD;;EACA,OAAK,IAAMQ,GAAX,IAAkBR,IAAlB,EAAwB;EACtBiB,IAAAA,KAAK,CAACzC,EAAD,EAAK,OAAL,EAAcgC,GAAd,CAAL;EACD,GALmB;;;EAOpBF,EAAAA,OAAO,CAACN,IAAD,CAAP;EACD;;EClDD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAMA;EACA;EACA;EACA;EACA;EACA;;EACO,SAASoB,SAAT,CAAmBjD,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAACC,SAAJ,CAAciD,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACvC;EACA,QAAM9C,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACsC,QAAH,GAAcQ,OAAd;EACAT,IAAAA,SAAS,CAACrC,EAAD,CAAT;;EAEA,QAAIA,EAAE,CAACsC,QAAH,CAAYhG,EAAhB,EAAoB;EAClB;EACA0D,MAAAA,EAAE,CAAC+C,MAAH,CAAU/C,EAAE,CAACsC,QAAH,CAAYhG,EAAtB;EACD;EACF,GAVD;;EAWAqD,EAAAA,GAAG,CAACC,SAAJ,CAAcmD,MAAd,GAAuB,UAAUzG,EAAV,EAAc;EACnC,QAAM0D,EAAE,GAAG,IAAX;EACA,QAAM8C,OAAO,GAAG9C,EAAE,CAACsC,QAAnB;EACAhG,IAAAA,EAAE,GAAG0G,QAAQ,CAACC,aAAT,CAAuB3G,EAAvB,CAAL;;EAEA,QAAI,CAACwG,OAAO,CAACtD,MAAb,EAAqB;EACnB,UAAI0D,QAAQ,GAAGJ,OAAO,CAACI,QAAvB;;EACA,UAAI,CAACA,QAAD,IAAa5G,EAAjB,EAAqB;EACnBoC,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAkBrC,EAAlB;EACA4G,QAAAA,QAAQ,GAAG5G,EAAE,CAAC6G,SAAd;EACA,YAAI3D,MAAM,GAAGH,iBAAiB,CAAC6D,QAAD,CAA9B;EACAJ,QAAAA,OAAO,CAACtD,MAAR,GAAiBA,MAAjB;EACD;EACF;;EACDd,IAAAA,OAAO,CAACC,GAAR,CAAYmE,OAAO,CAACtD,MAApB,EAdmC;;EAgBnCO,IAAAA,cAAc,CAACC,EAAD,CAAd;EACD,GAjBD;EAkBD;;ECjDD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,SAASoD,aAAT,CAAuBpD,EAAvB,EAA2BxC,GAA3B,EAAwD;EAAA,MAAxBgE,IAAwB,uEAAjB,EAAiB;;EAAA,oCAAVjF,QAAU;EAAVA,IAAAA,QAAU;EAAA;;EAC7D,SAAOuD,KAAK,CAACE,EAAD,EAAKxC,GAAL,EAAUgE,IAAV,EAAgBA,IAAI,CAACQ,GAArB,EAA0BzF,QAA1B,EAAoC8G,SAApC,CAAZ;EACD;EAEM,SAASC,iBAAT,CAA2BtD,EAA3B,EAA+BlD,IAA/B,EAAqC;EAC1C,SAAOgD,KAAK,CAACE,EAAD,EAAKqD,SAAL,EAAgBA,SAAhB,EAA2BA,SAA3B,EAAsCA,SAAtC,EAAiDvG,IAAjD,CAAZ;EACD;;EAED,SAASgD,KAAT,CAAeE,EAAf,EAAmBxC,GAAnB,EAAwBgE,IAAxB,EAA8BQ,GAA9B,EAAmCzF,QAAnC,EAA6CO,IAA7C,EAAmD;EACjD,SAAO;EAAEkD,IAAAA,EAAE,EAAFA,EAAF;EAAMxC,IAAAA,GAAG,EAAHA,GAAN;EAAWgE,IAAAA,IAAI,EAAJA,IAAX;EAAiBQ,IAAAA,GAAG,EAAHA,GAAjB;EAAsBzF,IAAAA,QAAQ,EAARA,QAAtB;EAAgCO,IAAAA,IAAI,EAAJA;EAAhC,GAAP;EACD;;EChBD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACO,SAASyG,WAAT,CAAqB5D,GAArB,EAA0B;EAC/BA,EAAAA,GAAG,CAACC,SAAJ,CAAc4D,EAAd,GAAmB,UAAUhG,GAAV,EAAegE,IAAf,EAAkC;EAAA,sCAAVjF,QAAU;EAAVA,MAAAA,QAAU;EAAA;;EACnD;EACA,WAAO6G,aAAa,MAAb,UAAc,IAAd,oCAAuBnH,SAAvB,GAAP;EACD,GAHD;;EAIA0D,EAAAA,GAAG,CAACC,SAAJ,CAAc6D,EAAd,GAAmB,UAAU3G,IAAV,EAAgB;EACjC,WAAOwG,iBAAiB,CAAC,IAAD,EAAOxG,IAAP,CAAxB;EACD,GAFD;;EAGA6C,EAAAA,GAAG,CAACC,SAAJ,CAAc8D,EAAd,GAAmB,UAAUC,GAAV,EAAe;EAChC,WAAOzH,IAAI,CAACC,SAAL,CAAewH,GAAf,CAAP;EACD,GAFD;;EAGAhE,EAAAA,GAAG,CAACC,SAAJ,CAAcM,OAAd,GAAwB,YAAY;EAClCxB,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;EACA,QAAMqB,EAAE,GAAG,IAAX;EACA,QAAIR,MAAM,GAAGQ,EAAE,CAACsC,QAAH,CAAY9C,MAAzB;EACA,IAAYA,MAAM,CAAC0B,IAAP,CAAYlB,EAAZ;EACb,GALD;EAMD;;ECvBD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EACA,SAASL,GAAT,CAAamD,OAAb,EAAsB;EACpB,OAAKD,KAAL,CAAWC,OAAX;EACD;;EAEDF,SAAS,CAACjD,GAAD,CAAT;EACA4D,WAAW,CAAC5D,GAAD,CAAX;;EACAD,cAAc,CAACC,GAAD,CAAd;;;;;;;;"}
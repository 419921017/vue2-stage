{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/global-api/index.js","../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/vdom/patch.js","../src/observer/dep.js","../src/observer/scheduler.js","../src/observer/watcher.js","../src/lifecycle.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:35:20\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-28 22:12:17\r\n */\r\nexport const isFunction = (fn) => typeof fn === \"function\";\r\nexport const isString = (str) => typeof str === \"string\";\r\nexport const isNumber = (num) => typeof num === \"number\";\r\nexport const isObject = (obj) => typeof obj === \"object\" && obj !== null;\r\nexport const isArray = (arr) => Array.isArray(arr);\r\n\r\nconst callbacks = [];\r\nlet pending = false;\r\n\r\nconst flushCallbacks = () => {\r\n  callbacks.forEach((cb) => cb());\r\n  pending = false;\r\n};\r\n\r\n/**\r\n * 调度系统的优雅降级\r\n *\r\n * @param {*} flushCallbacks\r\n */\r\nfunction timer(flushCallbacks) {\r\n  let timerFn = () => {};\r\n\r\n  if (Promise) {\r\n    timerFn = () => {\r\n      Promise.resolve().then(flushCallbacks);\r\n    };\r\n  } else if (MutationObserver) {\r\n    let textNode = document.createTextNode(\"1\");\r\n    let observe = new MutationObserver(flushCallbacks);\r\n    observe.observe(textNode, {\r\n      characterData: true,\r\n    });\r\n    timerFn = () => {\r\n      textNode.textContent = \"3\";\r\n    };\r\n  } else if (setImmediate) {\r\n    timerFn = () => {\r\n      setImmediate(flushCallbacks);\r\n    };\r\n  } else {\r\n    timerFn = () => {\r\n      setTimeout(flushCallbacks);\r\n    };\r\n  }\r\n  timerFn();\r\n}\r\n\r\nexport function nextTick(cb) {\r\n  callbacks.push(cb);\r\n\r\n  if (!pending) {\r\n    timer(flushCallbacks);\r\n    pending = true;\r\n  }\r\n}\r\n\r\nlet lifeCycleHooks = [\r\n  \"beforeCreate\",\r\n  \"created\",\r\n  \"beforeMount\",\r\n  \"mounted\",\r\n  \"beforeUpdate\",\r\n  \"updated\",\r\n  \"beforeDesotry\",\r\n  \"destoryed\",\r\n];\r\n\r\nlet strats = {};\r\n\r\nfunction mergeHook(parentVal, childVal) {\r\n  if (childVal) {\r\n    if (parentVal) {\r\n      return parentVal.concat(childVal);\r\n    } else {\r\n      return [childVal];\r\n    }\r\n  } else {\r\n    return parentVal;\r\n  }\r\n}\r\n\r\nlifeCycleHooks.forEach((hook) => {\r\n  strats[hook] = mergeHook;\r\n});\r\n\r\nexport function mergeOptions(parent, child) {\r\n  const options = {};\r\n  for (let key in parent) {\r\n    mergeFieId(key);\r\n  }\r\n  for (let key in child) {\r\n    if (key in parent) {\r\n      continue;\r\n    }\r\n    mergeFieId(key);\r\n  }\r\n  function mergeFieId(key) {\r\n    let parentVal = parent[key];\r\n    let childVal = child[key];\r\n    if (strats[key]) {\r\n      options[key] = strats[key](parentVal, childVal);\r\n    } else if (isObject(parentVal) && isObject(childVal)) {\r\n      options[key] = { ...parentVal, ...childVal };\r\n    } else {\r\n      options[key] = childVal;\r\n    }\r\n  }\r\n  return options;\r\n}\r\n","import { mergeOptions } from \"../utils\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-28 21:05:53\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-28 22:13:31\r\n */\r\nexport function initGlobalApi(Vue) {\r\n  // 用来存储全局配置\r\n  // 每个组件初始化的时候都会和options选项进行合并\r\n  Vue.options = {};\r\n  Vue.mixin = function (options) {\r\n    this.options = mergeOptions(this.options, options);\r\n  };\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-22 21:30:18\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-24 20:12:11\r\n */\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nfunction genProps(attrs) {\r\n  let str = '';\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i];\r\n    if (attr.name === 'style') {\r\n      let styleObj = {};\r\n      attr.value.replace(/([^;:]+)\\:([^;:]+)/g, function () {\r\n        styleObj[arguments[1].trim()] = arguments[2].trim();\r\n      });\r\n      attr.value = styleObj;\r\n    }\r\n    str += `${attr.name}: ${JSON.stringify(attr.value)},`;\r\n  }\r\n  return `{${str.slice(0, -1)}}`;\r\n}\r\n\r\nfunction genChildren(el) {\r\n  let children = el.children;\r\n\r\n  if (children) {\r\n    return children.map((child) => gen(child)).join(',');\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction gen(el) {\r\n  if (el.type == 1) {\r\n    return generate(el);\r\n  } else {\r\n    let text = el.text.trim();\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v('${text}')`;\r\n    } else {\r\n      let tokens = [];\r\n      let match;\r\n      // exec和正则中的g冲突, 每次操作的时候都要重置成0\r\n      let lastIndex = (defaultTagRE.lastIndex = 0);\r\n      while ((match = defaultTagRE.exec(text))) {\r\n        let index = match.index;\r\n        if (index > lastIndex) {\r\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)));\r\n        }\r\n        tokens.push(`_s(${match[1].trim()})`);\r\n        lastIndex = index + match[0].length;\r\n      }\r\n      if (lastIndex < text.length) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex)));\r\n      }\r\n      return `_v(${tokens.join('+')})`;\r\n    }\r\n  }\r\n}\r\n\r\nexport function generate(el) {\r\n  let children = genChildren(el);\r\n\r\n  let code = `_c('${el.tag}',${\r\n    el.attrs && el.attrs.length > 0 ? genProps(el.attrs) : 'undefined'\r\n  }${children ? `,${children}` : ''})`;\r\n\r\n  return code;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-22 21:17:10\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-22 21:18:21\r\n */\r\n\r\n// 标签名\r\nconst ncname = `[a-zA-Z_][\\\\w\\\\-\\\\.]*`;\r\n// 获取标签名, match[1]\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\n// 开始标签\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\n// 结束标签\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\n// 属性\r\nconst attribute =\r\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n// 标签关闭\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\n// {{}}\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nexport function parserHTML(html) {\r\n  let stack = [];\r\n  let root = null;\r\n  function createASTElement(tag, attrs, parent) {\r\n    return {\r\n      tag,\r\n      type: 1,\r\n      children: [],\r\n      parent,\r\n      attrs,\r\n    };\r\n  }\r\n  function start(tag, attrs) {\r\n    let parent = stack[stack.length - 1];\r\n    let element = createASTElement(tag, attrs, parent);\r\n    if (root == null) {\r\n      root = element;\r\n    }\r\n    if (parent) {\r\n      // 元素指向父节点\r\n      element.parent = parent;\r\n      // 父节点的children属性添加元素\r\n      parent.children.push(element);\r\n    }\r\n    stack.push(element);\r\n  }\r\n\r\n  function end(tag) {\r\n    let endTag = stack.pop();\r\n    if (endTag.tag != tag) {\r\n      console.log('标签出错');\r\n    }\r\n  }\r\n\r\n  function text(chars) {\r\n    let parent = stack[stack.length - 1];\r\n    chars.replace(/\\s/, '');\r\n    if (chars) {\r\n      parent.children.push({\r\n        type: 2,\r\n        text: chars,\r\n      });\r\n    }\r\n  }\r\n\r\n  function advance(len) {\r\n    html = html.substring(len);\r\n  }\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen);\r\n    if (start) {\r\n      const match = {\r\n        tagName: start[1],\r\n        attrs: [],\r\n      };\r\n      advance(start[0].length);\r\n      let end;\r\n      let attr;\r\n      // 不能是开始的结束标签\r\n      // 必须是属性\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5],\r\n        });\r\n        advance(attr[0].length);\r\n      }\r\n      if (end) {\r\n        advance(end[0].length);\r\n      }\r\n\r\n      return match;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  while (html) {\r\n    let index = html.indexOf('<');\r\n\r\n    if (index === 0) {\r\n      // 解析开始标签\r\n      const startTagMatch = parseStartTag();\r\n\r\n      if (startTagMatch) {\r\n        start(startTagMatch.tagName, startTagMatch.attrs);\r\n        continue;\r\n      }\r\n      let endTagMatch;\r\n      if ((endTagMatch = html.match(endTag))) {\r\n        end(endTagMatch[1]);\r\n        advance(endTagMatch[0].length);\r\n        continue;\r\n      }\r\n\r\n      break;\r\n    }\r\n    // 文本\r\n    if (index > 0) {\r\n      let chars = html.substring(0, index);\r\n      if (chars) {\r\n        text(chars);\r\n        advance(chars.length);\r\n      }\r\n    }\r\n  }\r\n  return root;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-21 20:40:53\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:16:27\r\n */\r\n\r\nimport { generate } from './generate';\r\nimport { parserHTML } from './parser';\r\n\r\nexport function compileToFunction(tempalte) {\r\n  const ast = parserHTML(tempalte);\r\n\r\n  let code = generate(ast);\r\n  // html => ast(只能描述语法) => render函数 => vdom(增加额外属性) => 生成真实DOM\r\n  // new Function + width\r\n  let render = new Function(`with(this) {return ${code}}`);\r\n  return render;\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-24 19:46:04\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-24 20:22:35\r\n */\r\nexport function patch(oldVnode, vnode) {\r\n  if (oldVnode.nodeType == 1) {\r\n    // console.log(\"真实节点\");\r\n    const parentElm = oldVnode.parentNode;\r\n\r\n    let elm = createEle(vnode);\r\n    parentElm.insertBefore(elm, oldVnode.nextSibling);\r\n    parentElm.removeChild(oldVnode);\r\n    return elm;\r\n  }\r\n}\r\n\r\nexport function createEle(vnode) {\r\n  let { tag, data, children, text, vm } = vnode;\r\n  if (typeof tag === 'string') {\r\n    vnode.el = document.createElement(tag);\r\n    updateProperties(vnode);\r\n    children.forEach((child) => {\r\n      vnode.el.appendChild(createEle(child));\r\n    });\r\n  } else {\r\n    vnode.el = document.createTextNode(text);\r\n  }\r\n  return vnode.el;\r\n}\r\n\r\nfunction updateProperties(vnode) {\r\n  let newProps = vnode.data || {};\r\n  let el = vnode.el;\r\n  for (let key in newProps) {\r\n    if (key == 'style') {\r\n      for (let styleName in newProps.style) {\r\n        el.style[styleName] = newProps.style[styleName];\r\n      }\r\n    } else {\r\n      el.setAttribute(key, newProps[key]);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-24 20:35:31\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-25 19:22:48\r\n */\r\n\r\nlet id = 0;\r\n// 每个属性都分配一个dep, dep可以存放watcher, 一个dep对应多个watcher, 一个watcher对应多个dep\r\nclass Dep {\r\n  constructor() {\r\n    this.id = id++;\r\n    this.subs = [];\r\n  }\r\n  depend() {\r\n    if (Dep.target) {\r\n      Dep.target.addDep(this);\r\n    }\r\n  }\r\n  addSub(watcher) {\r\n    this.subs.push(watcher);\r\n  }\r\n  notify() {\r\n    this.subs.forEach((watcher) => watcher.update());\r\n  }\r\n}\r\n\r\nDep.target = null;\r\n\r\n// 使用栈的方式存放多个watcher\r\nlet stack = [];\r\n\r\nexport function pushTarget(watcher) {\r\n  stack.push(watcher);\r\n  Dep.target = watcher;\r\n}\r\nexport function popTarget(watcher) {\r\n  stack.pop();\r\n  Dep.target = stack[stack.length - 1];\r\n}\r\n\r\nexport default Dep;\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-24 21:33:35\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-24 21:39:22\r\n */\r\n\r\nimport { nextTick } from '../utils';\r\n\r\nlet queue = [];\r\nlet has = {};\r\n\r\nlet pending = false;\r\nexport function queueWatcher(watcher) {\r\n  const id = watcher;\r\n  if (has[id] == null) {\r\n    queue.push(watcher);\r\n    has[id] = true;\r\n    if (!pending) {\r\n      nextTick(flushSchedulerQueue, 0);\r\n      pending = true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction flushSchedulerQueue() {\r\n  for (let i = 0; i < queue.length; i++) {\r\n    queue[i].run();\r\n  }\r\n  queue = [];\r\n  has = {};\r\n  pending = false;\r\n}\r\n","import { isString } from \"../utils\";\r\nimport { popTarget, pushTarget } from \"./dep\";\r\nimport { queueWatcher } from \"./scheduler\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-24 20:25:22\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-25 19:42:54\r\n */\r\nlet id = 0;\r\nclass Watcher {\r\n  constructor(vm, exprOrFn, cb, options) {\r\n    this.vm = vm;\r\n    this.exprOrFn = exprOrFn;\r\n    // 是不是用户watcher\r\n    this.user = !!options.user;\r\n    // 使用lazy区分是否是计算属性\r\n    this.lazy = !!options.lazy;\r\n    this.dirty = !!options.lazy;\r\n    this.cb = cb;\r\n    this.options = options;\r\n    this.id = id++;\r\n    // exprOrFn一调用就会取值\r\n    if (isString(exprOrFn)) {\r\n      // 如果表达式是字符串, 转换成函数\r\n      this.getter = function () {\r\n        // 当数据取值时, 会进行依赖收集\r\n        let obj = vm;\r\n        return exprOrFn.split(\".\").reduce((a, b) => a[b], obj);\r\n        // for (const item of exprOrFn.split('.')) {\r\n        //   obj = obj[item];\r\n        // }\r\n        // return obj;\r\n      };\r\n    } else {\r\n      this.getter = exprOrFn;\r\n    }\r\n    this.deps = [];\r\n    this.depsId = new Set();\r\n    // 默认的初始化操作\r\n    this.value = this.lazy ? undefined : this.get();\r\n  }\r\n  // 数据更新时, 重新调用getter\r\n  get() {\r\n    // 每个属性都可以收集自己的watcher, 一个属性对应多个watcher, 一个watcher对应多个属性\r\n    // Dep.target = watcher\r\n    pushTarget(this);\r\n    // render()方法会去vm上取值, vm._update(vm._render())\r\n    const value = this.getter.call(this.vm);\r\n    // Dep.target = null, 如果Dep.target有值, 说明值在模板中使用了\r\n    popTarget();\r\n    return value;\r\n  }\r\n  addDep(dep) {\r\n    let id = dep.id;\r\n    // 实现去重\r\n    if (!this.depsId.has(id)) {\r\n      // watcher收集dep\r\n      this.depsId.add(id);\r\n      this.deps.push(dep);\r\n      // dep收集watcher\r\n      dep.addSub(this);\r\n    }\r\n  }\r\n  update() {\r\n    // this.get();\r\n    if (this.lazy) {\r\n      this.dirty = true;\r\n    } else {\r\n      queueWatcher(this);\r\n    }\r\n  }\r\n  run() {\r\n    const newValue = this.get();\r\n    let oldValue = this.value;\r\n    // 替换旧值\r\n    this.value = newValue;\r\n    console.log(\"this.cb\", this.cb);\r\n    this.user && this.cb.call(this.vm, newValue, oldValue);\r\n  }\r\n  evaluate() {\r\n    // 取过值了\r\n    this.dirty = false;\r\n    this.value = this.get();\r\n  }\r\n  depend() {\r\n    let i = this.deps.length;\r\n    while (i--) {\r\n      this.deps[i].depend();\r\n    }\r\n  }\r\n}\r\n\r\n// 将更新功能封装成了一个watcher\r\n// 渲染页面前, 会将当前watcher放到Dep类上\r\n// 在vue找那个渲染页面使用的属性, 需要进行依赖收集, 收集对象的渲染watcher\r\n// 取值时, 给每个属性都加了dep属性, 用于存储这个渲染watcher, 同一个watcher会对应多个dep\r\n// 每给属性可能对应多个视图(多个watcher), 一个属性对应多个watcher\r\n// dep.depend(), 通知dep存放watcher => Dep.target.addDep(), 通知watcher存放dep\r\n// dep和watcher是双向取值的\r\nexport default Watcher;\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:18:30\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-28 22:08:56\r\n */\r\n\r\nimport { patch } from \"./vdom/patch\";\r\nimport Watcher from \"./observer/watcher\";\r\nimport { nextTick } from \"./utils\";\r\n\r\nexport function lifecycleMixin(Vue) {\r\n  Vue.prototype._update = function (vnode) {\r\n    const vm = this;\r\n    vm.$el = patch(vm.$el, vnode);\r\n  };\r\n  Vue.prototype.$nextTick = nextTick;\r\n}\r\n\r\nexport function mountComponent(vm, el) {\r\n  // 更新函数, 数据变化后会再次调用\r\n  let updateComponent = () => {\r\n    // 调用render函数, 生成虚拟dom\r\n    vm._update(vm._render());\r\n    // 用虚拟dom生成真实dom\r\n  };\r\n  callHook(vm, \"beforeMount\");\r\n  // updateComponent();\r\n  // true表示这是一个渲染watcher\r\n  // 每个组件都对一个渲染watcher\r\n  new Watcher(\r\n    vm,\r\n    updateComponent,\r\n    () => {\r\n      console.log(\"udpate\");\r\n    },\r\n    true\r\n  );\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n  vm.$options[hook] && vm.$options[hook].forEach((fn) => fn.call(vm));\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-21 20:23:55\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-21 20:50:04\r\n */\r\nconst oldArrayPrototype = Array.prototype;\r\nconst arrayMethods = Object.create(oldArrayPrototype);\r\n\r\nconst methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'reverse',\r\n  'sort',\r\n];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    oldArrayPrototype[method].call(this, ...args);\r\n    let inserted;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshfit':\r\n        inserted = args; // 就是新增的内容\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    if (inserted) {\r\n      ob.observeArray(inserted);\r\n    }\r\n    // 数组的observe.dep\r\n    ob.dep.notify();\r\n  };\r\n});\r\n\r\nexport default arrayMethods;\r\n","import { isArray, isObject } from '../utils';\r\nimport arrayMethods from './array';\r\nimport Dep from './dep';\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:38:12\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-24 21:10:10\r\n */\r\n\r\n// 给对象新增一个属性, 不会触发更新, 可以通过$set, 给对象本身增加一个dep, dep存watcher, 如果增加一个属性后, 手动触发watcher\r\nclass Observer {\r\n  constructor(data) {\r\n    this.dep = new Dep();\r\n    // 给对象和数组添加一个自定义属性\r\n    // __ob__ 会造成死循环\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      // 这属性不能被枚举, 无法被循环到\r\n      enumerable: false,\r\n    });\r\n    // data.__ob__ = this;\r\n    if (isArray(data)) {\r\n      // 重写数组方法\r\n      data.__proto__ = arrayMethods;\r\n      this.observeArray(data);\r\n    } else {\r\n      this.walk(data);\r\n    }\r\n  }\r\n  // 递归遍历数组, 对数组内部的对象再次进行重写[[]] [{}]\r\n  observeArray(data) {\r\n    // 数组里面如果是引用类型, 继续进行observe, 响应式\r\n    data.forEach((item) => observe(item));\r\n  }\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 数组的子元素还是数组的情况\r\n *\r\n * @param {*} value\r\n */\r\nfunction dependArray(value) {\r\n  for (let i = 0; i < value.length; i++) {\r\n    const current = value[i];\r\n    current.__ob__ && current.__ob__.dep.depend();\r\n    if (isArray(current)) {\r\n      dependArray(current);\r\n    }\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  // value有可能是对象\r\n  // 如果value是对象, 需要进行递归处理\r\n  let childOb = observe(value);\r\n  // 每个属性都对应一个dep\r\n  let dep = new Dep();\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      // 如果Dep.target有值, 说明属性在模板中被使用了\r\n      if (Dep.target) {\r\n        // dep记住watcher\r\n        dep.depend();\r\n        // 可能是数组, 可能是对象\r\n        if (childOb) {\r\n          // 数组和对象也记住watcher\r\n          childOb.dep.depend();\r\n          if (isArray(value)) {\r\n            dependArray(value);\r\n          }\r\n        }\r\n      }\r\n      return value;\r\n    },\r\n    set(newVal) {\r\n      if (newVal === value) return;\r\n      // 设置了新对象, 需要重新进行劫持\r\n      observe(newVal);\r\n      value = newVal;\r\n      dep.notify();\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  // console.log(\"observe\", data);\r\n  // 不是对象不处理\r\n  if (!isObject(data)) {\r\n    return;\r\n  }\r\n  // 已经响应式的对象不处理\r\n  if (data.__ob__) {\r\n    return data.__ob__;\r\n  }\r\n  return new Observer(data);\r\n}\r\n\r\n// 1. Vue中对象层次不能嵌套太深, 否则会有大量递归\r\n// 2. Vue中对象是通过Object.definePrototype实现响应式的, 拦截了get和set, 如果不存在的属性不会拦截, 也不会响应\r\n//    可以使用$set来让对象自己来实现notify, 或者赋予一个新对象\r\n// 3. Vue中数组修改索引或者长度也不会进行视图更新, 通过修改原型的7个方法从而达成视图更新, 数组中如果是对象类型, 修改对象也可以更新视图\r\n","import { observe } from \"./observer\";\r\nimport Dep from \"./observer/dep\";\r\nimport Watcher from \"./observer/watcher\";\r\nimport { isArray, isFunction } from \"./utils\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:29:52\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-25 19:25:56\r\n */\r\nexport function stateMixin(Vue) {\r\n  Vue.prototype.$watch = function (key, handler, options = {}) {\r\n    options.user = true;\r\n    let watcher = new Watcher(this, key, handler, options);\r\n    if (options.immediate) {\r\n      handler(watcher.value);\r\n    }\r\n  };\r\n}\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  // if (opts.props) {\r\n  // }\r\n\r\n  // if (opts.methods) {\r\n  // }\r\n\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n\r\n  if (opts.computed) {\r\n    initComputed(vm, opts.computed);\r\n  }\r\n\r\n  if (opts.watch) {\r\n    initWatch(vm, opts.watch);\r\n  }\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal;\r\n    },\r\n  });\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n  for (const key in data) {\r\n    proxy(vm, \"_data\", key);\r\n  }\r\n  observe(data);\r\n}\r\n\r\nfunction initWatch(vm, watch) {\r\n  Object.keys(watch).forEach((key) => {\r\n    const handler = watch[key];\r\n    if (isArray(handler)) {\r\n      for (const fn of handler) {\r\n        createWatcher(vm, key, fn);\r\n      }\r\n    } else {\r\n      createWatcher(vm, key, handler);\r\n    }\r\n  });\r\n}\r\n\r\nfunction createWatcher(vm, key, handler) {\r\n  return vm.$watch(key, handler);\r\n}\r\n\r\nfunction initComputed(vm, computed) {\r\n  // 包含实例上所有的watcher属性\r\n  const watchers = (vm._computedWatchers = {});\r\n  Object.keys(computed).forEach((key) => {\r\n    const userDef = computed[key];\r\n    let getter = isFunction(userDef) ? userDef : userDef.get;\r\n    console.log(\"getter\", getter);\r\n    // 每个计算属性, 本质上是一个watcher\r\n    watchers[key] = new Watcher(vm, getter, () => {}, {\r\n      lazy: true,\r\n    });\r\n    defineComputed(vm, key, userDef);\r\n  });\r\n}\r\n\r\nfunction defineComputed(vm, key, userDef) {\r\n  let sharedProperty = {};\r\n  if (isFunction(userDef)) {\r\n    sharedProperty.get = userDef;\r\n  } else {\r\n    sharedProperty.get = createComputedGetter(key);\r\n    sharedProperty.set = userDef.set;\r\n  }\r\n  // computed本质上就是是个 Object.defineProperty\r\n  Object.defineProperty(vm, key, sharedProperty);\r\n}\r\n\r\nfunction createComputedGetter(key) {\r\n  // 取计算属性的值\r\n  return function computedGetter() {\r\n    // 这个watcher中包含了getter\r\n    let watcher = this._computedWatchers[key];\r\n    // 根据dirty属性来判断是否需要重新求值\r\n    // 脏就是意味着需要调用用户的getter\r\n    // 不脏就不用调用用户的getter\r\n    if (watcher.dirty) {\r\n      watcher.evaluate();\r\n    }\r\n    // 如果渲染watcher存在, 计算属性也需要收集渲染watcher\r\n    if (Dep.target) {\r\n      // watcher属性对应多个dep\r\n      // 计算属性watcher对应内部有多个dep(computed所依赖的属性)\r\n      watcher.depend();\r\n    }\r\n    return watcher.value;\r\n  };\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:24:30\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-28 22:12:29\r\n */\r\n\r\nimport { compileToFunction } from \"./compiler\";\r\nimport { callHook, mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\nimport { mergeOptions } from \"./utils\";\r\n\r\n/**\r\n *\r\n * 在Vue的基础上做一次混合操作\r\n * @export\r\n * @param {*} Vue\r\n */\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this;\r\n    vm.$options = mergeOptions(vm.constructor.options, options);\r\n    callHook(vm, \"beforeCreate\");\r\n    initState(vm);\r\n    callHook(vm, \"created\");\r\n    if (vm.$options.el) {\r\n      // 将数据挂在模板上\r\n      vm.$mount(vm.$options.el);\r\n    }\r\n  };\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this;\r\n    const options = vm.$options;\r\n    el = document.querySelector(el);\r\n    vm.$el = el;\r\n    if (!options.render) {\r\n      let template = options.template;\r\n      if (!template && el) {\r\n        template = el.outerHTML;\r\n        let render = compileToFunction(template);\r\n        options.render = render;\r\n      }\r\n    }\r\n\r\n    // 组件的挂载流程\r\n    mountComponent(vm, el);\r\n  };\r\n}\r\n","/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:31:22\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-23 21:35:54\r\n */\r\nexport function createElement(vm, tag, data = {}, ...children) {\r\n  return vnode(vm, tag, data, data.key, children, undefined);\r\n}\r\n\r\nexport function createTextElement(vm, text) {\r\n  return vnode(vm, undefined, undefined, undefined, undefined, text);\r\n}\r\n\r\nfunction vnode(vm, tag, data, key, children, text) {\r\n  return { vm, tag, data, key, children, text };\r\n}\r\n","import { isObject } from './utils';\r\nimport { createElement, createTextElement } from './vdom';\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-23 21:23:10\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-24 19:59:20\r\n */\r\nexport function renderMixin(Vue) {\r\n  Vue.prototype._c = function (tag, data, ...children) {\r\n    // @ts-ignore\r\n    return createElement(this, ...arguments);\r\n  };\r\n  Vue.prototype._v = function (text) {\r\n    return createTextElement(this, text);\r\n  };\r\n  Vue.prototype._s = function (val) {\r\n    if (isObject(val)) {\r\n      return JSON.stringify(val);\r\n    }\r\n    return val;\r\n  };\r\n  Vue.prototype._render = function () {\r\n    const vm = this;\r\n    let render = vm.$options.render;\r\n    let vnode = render.call(vm);\r\n    return vnode;\r\n  };\r\n}\r\n","import { initGlobalApi } from \"./global-api\";\r\nimport { initMixin } from \"./init\";\r\nimport { lifecycleMixin } from \"./lifecycle\";\r\nimport { renderMixin } from \"./render\";\r\nimport { stateMixin } from \"./state\";\r\n\r\n/*\r\n * @Descripttion: your project\r\n * @version: 1.0\r\n * @Author: power_840\r\n * @Date: 2021-06-17 21:07:28\r\n * @LastEditors: power_840\r\n * @LastEditTime: 2021-06-28 21:06:52\r\n */\r\nfunction Vue(options) {\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\nrenderMixin(Vue); // _render\r\nlifecycleMixin(Vue); // _update\r\nstateMixin(Vue); // $watch\r\n\r\n// 在类上扩展 Vue.mixin\r\ninitGlobalApi(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["isFunction","fn","isString","str","isObject","obj","isArray","arr","Array","callbacks","pending","flushCallbacks","forEach","cb","timer","timerFn","Promise","resolve","then","MutationObserver","textNode","document","createTextNode","observe","characterData","textContent","setImmediate","setTimeout","nextTick","push","lifeCycleHooks","strats","mergeHook","parentVal","childVal","concat","hook","mergeOptions","parent","child","options","key","mergeFieId","initGlobalApi","Vue","mixin","defaultTagRE","genProps","attrs","i","length","attr","name","styleObj","value","replace","arguments","trim","JSON","stringify","slice","genChildren","el","children","map","gen","join","type","generate","text","test","tokens","match","lastIndex","exec","index","code","tag","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","stack","root","createASTElement","start","element","end","pop","console","log","chars","advance","len","substring","parseStartTag","tagName","indexOf","startTagMatch","endTagMatch","compileToFunction","tempalte","ast","render","Function","patch","oldVnode","vnode","nodeType","parentElm","parentNode","elm","createEle","insertBefore","nextSibling","removeChild","data","vm","createElement","updateProperties","appendChild","newProps","styleName","style","setAttribute","id","Dep","subs","target","addDep","watcher","update","pushTarget","popTarget","queue","has","queueWatcher","flushSchedulerQueue","run","Watcher","exprOrFn","user","lazy","dirty","getter","split","reduce","a","b","deps","depsId","Set","undefined","get","call","dep","add","addSub","newValue","oldValue","depend","lifecycleMixin","prototype","_update","$el","$nextTick","mountComponent","updateComponent","_render","callHook","$options","oldArrayPrototype","arrayMethods","Object","create","methods","method","args","inserted","ob","__ob__","observeArray","notify","Observer","defineProperty","enumerable","__proto__","walk","item","keys","defineReactive","dependArray","current","childOb","set","newVal","stateMixin","$watch","handler","immediate","initState","opts","initData","computed","initComputed","watch","initWatch","proxy","source","_data","createWatcher","watchers","_computedWatchers","userDef","defineComputed","sharedProperty","createComputedGetter","computedGetter","evaluate","initMixin","_init","constructor","$mount","querySelector","template","outerHTML","createTextElement","renderMixin","_c","_v","_s","val"],"mappings":"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"}